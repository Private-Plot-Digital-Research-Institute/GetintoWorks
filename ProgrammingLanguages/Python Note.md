## 系统机制

### 垃圾回收

[Python 中的垃圾回收机制 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/62282961)

python里每一个东西都是对象，它们的核心就是一个结构体：PyObject

PyObject是每个对象必有的内容，其中ob_refcnt就是做为引用计数。当一个对象有新的引用时，它的ob_refcnt就会增加，当引用它的对象被删除，它的ob_refcnt就会减少

引用计数为0时，该对象生命就结束了。

**引用计数机制的优点：**

1、简单

2、实时性：一旦没有引用，内存就直接释放了，不用像其他机制得等到特定时机。实时性还带来一个好处：处理回收内存的时间分摊到了平时。

**引用计数机制的缺点：**

1、维护引用计数消耗资源

2、循环引用

#### **gc模块**

gc模块提供一个接口给开发者设置垃圾回收的选项。上面说到，采用引用计数的方法管理内存的一个缺陷是循环引用，而gc模块的一个主要功能就是解决循环引用的问题。

####  **分代回收**

- 分代回收是一种以空间换时间的操作方式，Python将内存根据对象的存活时间划分为不同的集合，每个集合称为一个代，Python将内存分为了3“代”，分别为年轻代（第0代）、中年代（第1代）、老年代（第2代），他们对应的是3个链表，它们的垃圾收集频率随着对象存活时间的增大而减小。
- 新创建的对象都会分配在**年轻代**，年轻代链表的总数达到上限时，Python垃圾收集机制就会被触发，把那些可以被回收的对象回收掉，而那些不会回收的对象就会被移到**中年代**去，依此类推，**老年代**中的对象是存活时间最久的对象，甚至是存活于整个系统的生命周期内。
- 同时，分代回收是建立在标记清除技术基础之上。分代回收同样作为Python的辅助垃圾收集技术处理那些容器对象

#### **垃圾回收**

有三种情况会触发垃圾回收：

1. 调用`gc.collect()`,需要先导入`gc`模块。
2. 当`gc`模块的计数器达到阈值的时候。
3. 程序退出的时候。

#### **gc模块的自动垃圾回收机制**

必须要import gc模块，并且is_enable()=True才会启动自动垃圾回收。  
这个机制的主要作用就是发现并处理不可达的垃圾对象。

> 垃圾回收=垃圾检查+垃圾回收

在Python中，采用分代收集的方法。把对象分为三代，一开始，对象在创建的时候，放在一代中，如果在一次一代的垃圾检查中，该对象存活下来，就会被放到二代中，同理在一次二代的垃圾检查中，该对象存活下来，就会被放到三代中。


### 引用，深拷贝

[5张图彻底理解Python中的浅拷贝与深拷贝 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/57893374)

1. Python 内不可变对象(例如字符串）的内存管理方式是引用计数。
```python
import copy

a = "张小鸡"
b = a
c = copy.copy(a)
d = copy.deepcopy(a)

print "赋值：id(b)->>>", id(b)
print "浅拷贝：id(c)->>>", id(c)
print "深拷贝：id(d)->>>", id(c)
```

输出如下

```python
赋值：id(b)->>> 4394180400
浅拷贝：id(c)->>> 4394180400
深拷贝：id(d)->>> 4394180400
```


1. 赋值就是对物体进行贴标签操作，作用于同一物体。而浅拷贝则会创建一个新的对象，至于对象中的元素，它依然会引用原来的物体
**操作不可变对象时，浅拷贝和深拷贝是没有区别的**

深拷贝遇到可变对象，则又会进行一层对象创建，所以你操作被拷贝对象内部的可变对象，不影响拷贝对象内部的值
### 数据对象

https://www.zhihu.com/question/589268232/answer/2996271073  

- 可变对象：比如说列表(list)，字典(dict)，集合(set)，字节数组(bytearray)，类的实例对象。
- 不可变对象：整型(int)，浮点型(float)，复数(complex)，字符串，元祖(tuple)，不可变集合(frozenset)，字节(bytes)

  https://www.zhihu.com/question/359370397/answer/2738294766  
  
### Numba
Numba 是 python 的即时（Just-in-time）编译器，即当你调用 python 函数时，你的全部或部分代码就会被转换为“即时”执行的机器码，它将以你的本地机器码速度运行！它由 Anaconda 公司赞助，并得到了许多其他组织的支持。

在 Numba 的帮助下，你可以加速所有计算负载比较大的 python 函数（例如循环）。它还支持 numpy 库！所以，你也可以在你的计算中使用 numpy，并加快整体计算，因为 python 中的循环非常慢。你还可以使用 python 标准库中的 math 库的许多函数，如 sqrt 等。有关所有兼容函数的完整列表，请查看此处。

